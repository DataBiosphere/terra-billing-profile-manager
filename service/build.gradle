plugins {
	id 'bio.terra.profile.java-spring-conventions'
	id 'de.undercouch.download'
	id 'com.google.cloud.tools.jib'

	id 'com.gorylenko.gradle-git-properties' version '2.4.1'
	id 'org.sonarqube' version '3.5.0.2730'
}

apply from: 'generators.gradle'
apply from: 'publishing.gradle'

dependencies {
	implementation 'io.sentry:sentry:6.13.0'

	implementation('org.yaml:snakeyaml') {
		version {
			require "1.32"
		}
		because 'previous versions have a security vulnerability - this is a direct dependency to force the version to override opencensus'
	}
	implementation 'bio.terra:terra-common-lib:0.0.77-SNAPSHOT'

	implementation 'org.apache.commons:commons-dbcp2'
	implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.retry:spring-retry'
	implementation group: "org.apache.commons", name: "commons-lang3"

	implementation 'org.springframework.boot:spring-boot-starter-actuator:2.7.8'
	implementation 'io.micrometer:micrometer-registry-prometheus'

	// Google dependencies
	implementation platform('com.google.cloud:libraries-bom:26.5.0')

	// Cloud Resource Library
	implementation group: "com.azure.resourcemanager", name: "azure-resourcemanager-managedapplications", version: "1.0.0-beta.2"
	implementation group: "com.azure.resourcemanager", name: "azure-resourcemanager-subscription", version: "1.0.0-beta.2"


	// TODO: remove SNAPSHOT once https://github.com/DataBiosphere/terra-cloud-resource-lib/pull/109 is merged
	implementation platform('bio.terra.cloud-resource-lib:platform:0.8.2-SNAPSHOT')
	implementation group: 'bio.terra.cloud-resource-lib', name: 'google-billing'
	implementation group: 'bio.terra.cloud-resource-lib', name: 'azure-resourcemanager-common'

	// Sam
	implementation group: "org.broadinstitute.dsde.workbench", name: "sam-client_2.13", version: "0.1-e0d8da8"

	// Test deps
	testImplementation('org.springframework.boot:spring-boot-starter-test') {
		exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
	}
	// Allows us to mock final classes
	testImplementation 'org.mockito:mockito-inline:5.1.1'
}

sonarqube {
	properties {
		property "sonar.projectName", "terra-billing-profile-manager"
		property "sonar.projectKey", "DataBiosphere_terra-billing-profile-manager"
		property "sonar.organization", "broad-databiosphere"
		property "sonar.host.url", "https://sonarcloud.io"
		property "sonar.sources", "src/main/java"
	}
}
